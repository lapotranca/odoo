<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="as_header_report">
        <div t-attf-class="o_company_#{o.company_id.id}_layout" t-att-style="report_header_style">
            <div class="o_background_header">
                <div class="float-right">
                    <h3 class="mt0 text-right" t-field="o.company_id.report_header" />
                </div>
                <img t-if="o.company_id.logo" t-att-src="image_data_uri(o.company_id.logo)" class="float-left"
                    alt="Logo" />
                <div class="float-left company_address">
                    <div>
                        <strong t-field="o.company_id.partner_id.name" />
                    </div>
                    <span t-field="o.company_id.partner_id"
                        t-options="{&quot;widget&quot;: &quot;contact&quot;, &quot;fields&quot;: [&quot;address&quot;], &quot;no_marker&quot;: true}" />
                    <!--<div><h7>Num. de Factura: </h7><span  t-field="o.name"/></div>-->
                </div>
                <div class="clearfix mb8" />
            </div>
        </div>
        <div t-attf-class="o_company_#{o.company_id.id}_layout article" t-att-data-oe-model="o and o._name"
            t-att-data-oe-id="o and o.id" t-att-data-oe-lang="o and o.env.context.get('lang')">
            <t t-call="web.address_layout" />
            <t t-raw="0" />
        </div>
    </template>

    <template id="as_header_report_not">

        <h2 style="color:#3c922d;">
            <span t-if="o.type == 'out_invoice' and o.state == 'posted'">Factura </span>
            <span t-if="o.type == 'out_invoice' and o.state == 'draft'">Factura Borrador</span>
            <span t-if="o.type == 'out_invoice' and o.state == 'cancel'">Factura Cancelada</span>
            <span t-if="o.type == 'out_refund'">Nota de Credito</span>
            <span t-if="o.type == 'in_refund'">Nota de Debito</span>
            <span t-if="o.type == 'in_invoice'">Factura de Proveedor</span>
            <span t-if="o.name != '/'" t-field="o.name" />
        </h2>
        <t t-if="o.l10n_mx_edi_cfdi_uuid">
            <!--New global variables-->
            <t t-set="xml" t-value="o.l10n_mx_edi_get_xml_etree()" />
            <t t-set="tfd" t-value="o.l10n_mx_edi_get_tfd_etree(xml)" />
            <t t-set="tfd_original_string" t-value="o._get_l10n_mx_edi_cadena()" />
            <t t-set="external" t-value="o.l10n_mx_edi_get_et_etree(xml)" />
        </t>
        <div id="informations" class="row mt32 mb32">
            <div class="col-auto mw-100 mb-2" t-if="o.invoice_date" name="invoice_date">
                <strong>Fecha Factura:</strong>
                <p class="m-0" t-field="o.invoice_date" />
            </div>
            <div class="col-auto mw-100 mb-2"
                t-if="o.invoice_date_due and o.type == 'out_invoice' and o.state == 'posted'" name="due_date">
                <strong>Fecha de Vencimiento:</strong>
                <p class="m-0" t-field="o.invoice_date_due" />
            </div>
            <div class="col-auto mw-100 mb-2" t-if="o.invoice_origin" name="origin">
                <strong>Origen:</strong>
                <p class="m-0" t-field="o.invoice_origin" />
            </div>
            <div class="col-auto mw-100 mb-2" t-if="o.partner_id.ref" name="customer_code">
                <strong>Codigo Cliente:</strong>
                <p class="m-0" t-field="o.partner_id.ref" />
            </div>
            <t t-set="original_o_grid_layout" t-value="o_grid_layout" />
            <t t-set="o_grid_layout" t-value="'col-auto mw-100 mb-2'" />
            <t t-if="o.l10n_mx_edi_cfdi_uuid">
                <t t-if="xml.Receptor.get('UsoCFDI', False)">
                    <t t-set="usage" t-value="xml.Receptor.get('UsoCFDI')" />
                    <div name="usage" t-att-class="o_grid_layout">
                        <strong>Uso:</strong>
                        <p class="m-0"><span t-esc="usage" /> - <span t-field="o.l10n_mx_edi_usage" /></p>
                    </div>
                </t>
                <t t-if="o.l10n_mx_edi_payment_method_id">
                    <div t-att-class="o_grid_layout">
                        <strong>Forma de Pago:</strong>
                        <p class="m-0"
                            t-esc="' - '.join([o.l10n_mx_edi_payment_method_id.code, o.l10n_mx_edi_payment_method_id.name])" />
                    </div>
                </t>
                <div t-att-class="o_grid_layout">
                    <strong>Metodo de Pago:</strong>
                    <p class="m-0" t-esc="xml.get('formaDePago', xml.get('MetodoPago'))" />
                </div>
                <div t-att-class="o_grid_layout" t-if="xml.get('NumCtaPago')">
                    <strong>Cuenta de Banco:</strong>
                    <p class="m-0" t-esc="xml.get('NumCtaPago')" />
                </div>
            </t>
            <t t-set="o_grid_layout" t-value="original_o_grid_layout" />
            <div class="col-auto mw-100 mb-2" t-if="o.ref" name="reference">
                <strong>Referencia:</strong>
                <p class="m-0" t-field="o.ref" />
            </div>
        </div>


    </template>


    <template id="as_report_invoice_report" inherit_id="account.report_invoice_document">
        <xpath expr="//t[@t-call='web.external_layout']" position="attributes">
            <attribute name="t-call">web.basic_layout</attribute>
        </xpath>

        <xpath expr="//h2[1]" position="replace">
            <h2>
            </h2>
        </xpath>
        <xpath expr="//div[@id='informations']" position="replace">

        </xpath>
        <xpath expr="//div[@class='page']" position="before">
            <div class="header">
                <div class="first-page">
                    <t t-call="as_potranca_invoice.as_header_report" />
                </div>
                <t t-call="as_potranca_invoice.as_header_report_not" />

            </div>
        </xpath>
        <xpath expr="//div[@class='page']" position="replace">
            <div class="page" style="font-size:13px;">
                <div>
                    <br />
                    <br />
                    <br />
                    <br />
                    <br />
                    <br />
                    <br />
                    <br />
                    <br />
                </div><br /><br /><br />
                <t t-if="o.l10n_mx_edi_cfdi_uuid">
                    <!--New global variables-->
                    <t t-set="xml" t-value="o.l10n_mx_edi_get_xml_etree()" />
                    <t t-set="tfd" t-value="o.l10n_mx_edi_get_tfd_etree(xml)" />
                    <t t-set="tfd_original_string" t-value="o._get_l10n_mx_edi_cadena()" />
                    <t t-set="external" t-value="o.l10n_mx_edi_get_et_etree(xml)" />
                </t>
                <t t-set="display_discount" t-value="any([l.discount for l in o.invoice_line_ids])" />

                <table class="table table-sm o_main_table" name="invoice_line_table">
                    <thead>
                        <tr>
                            <!-- TODO: remove in master -->
                            <t t-set="colspan" t-value="6" />
                            <th t-if="o.l10n_mx_edi_cfdi_uuid and xml.get('Version')">
                                <span>Código Producto</span>
                            </th>
                            <th name="th_description" class="text-left"><span>Descripción</span></th>
                            <!-- TODO: remove in master -->
                            <th name="th_source" class="d-none text-left" t-if="0"><span>Documento Origen</span></th>
                            <th name="th_quantity" class="text-right"><span>Cantidad</span></th>
                            <th class="text-right" t-if="o.l10n_mx_edi_cfdi_uuid and xml.get('Version')">
                                <span>Código Unidad</span>
                            </th>
                            <th name="th_priceunit"
                                t-attf-class="text-right {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                <span>Precio Unitario</span></th>
                            <th name="th_price_unit" t-if="display_discount"
                                t-attf-class="text-right {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                <span>Desc.%</span>
                                <!-- TODO: remove in master -->
                                <t t-set="colspan" t-value="colspan+1" />
                            </th>
                            <th name="th_taxes"
                                t-attf-class="text-left {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                <span>Impuestos</span></th>
                            <th name="th_subtotal" class="text-right">
                                <span groups="account.group_show_line_subtotals_tax_excluded">Importe</span>
                                <span groups="account.group_show_line_subtotals_tax_included">Precio Total</span>
                            </th>
                        </tr>
                    </thead>
                    <tbody class="invoice_tbody">
                        <t t-set="current_subtotal" t-value="0" />
                        <t t-set="lines"
                            t-value="o.invoice_line_ids.sorted(key=lambda l: (-l.sequence, l.date, l.move_name, -l.id), reverse=True)" />

                        <t t-foreach="lines" t-as="line">
                            <t t-set="current_subtotal" t-value="current_subtotal + line.price_subtotal"
                                groups="account.group_show_line_subtotals_tax_excluded" />
                            <t t-set="current_subtotal" t-value="current_subtotal + line.price_total"
                                groups="account.group_show_line_subtotals_tax_included" />

                            <tr
                                t-att-class="'bg-200 font-weight-bold o_line_section' if line.display_type == 'line_section' else 'font-italic o_line_note' if line.display_type == 'line_note' else ''">
                                <t t-if="not line.display_type" name="account_invoice_line_accountable">
                                <td t-if="o.l10n_mx_edi_cfdi_uuid and xml.get('Version')"><span t-field="line.product_id.l10n_mx_edi_code_sat_id.code"/></td>
                                    <td name="account_invoice_line_name"><span t-field="line.name"
                                            t-options="{'widget': 'text'}" /></td>
                                    <td class="text-right">
                                        <span t-field="line.quantity" />
                                        <span t-field="line.product_uom_id" groups="uom.group_uom" />
                                    </td>
                                        <td class="text-right" t-if="o.l10n_mx_edi_cfdi_uuid and xml.get('Version')"><span t-field="line.product_uom_id.l10n_mx_edi_code_sat_id.code"/></td>
                                    <td
                                        t-attf-class="text-right {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                        <span class="text-nowrap" t-field="line.price_unit" />
                                    </td>
                                    <td t-if="display_discount"
                                        t-attf-class="text-right {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                        <span class="text-nowrap" t-field="line.discount" />
                                    </td>
                                    <td
                                        t-attf-class="text-left {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                        <span t-esc="', '.join(map(lambda x: (x.description or x.name), line.tax_ids))"
                                            id="line_tax_ids" />
                                    </td>
                                    <td class="text-right o_price_total">
                                        <span class="text-nowrap" t-field="line.price_subtotal"
                                            groups="account.group_show_line_subtotals_tax_excluded" />
                                        <span class="text-nowrap" t-field="line.price_total"
                                            groups="account.group_show_line_subtotals_tax_included" />
                                    </td>
                                </t>
                                <t t-if="line.display_type == 'line_section'">
                                    <td colspan="99">
                                        <span t-field="line.name" t-options="{'widget': 'text'}" />
                                    </td>
                                    <t t-set="current_section" t-value="line" />
                                    <t t-set="current_subtotal" t-value="0" />
                                </t>
                                <t t-if="line.display_type == 'line_note'">
                                    <td colspan="99">
                                        <span t-field="line.name" t-options="{'widget': 'text'}" />
                                    </td>
                                </t>
                            </tr>

                            <t
                                t-if="current_section and (line_last or lines[line_index+1].display_type == 'line_section')">
                                <tr class="is-subtotal text-right">
                                    <td colspan="99">
                                        <strong class="mr16">Subtotal</strong>
                                        <span t-esc="current_subtotal"
                                            t-options='{"widget": "monetary", "display_currency": o.currency_id}' />
                                    </td>
                                </tr>
                            </t>
                        </t>
                    </tbody>
                </table>

                <div class="clearfix">
                    <div id="total" class="row">
                        <div class="col-6" style="line-height:17px;">
                            <p t-if="o.type in ('out_invoice', 'in_refund')">
                                Utilice la siguiente comunicación para su pago: <b><span
                                        t-field="o.invoice_payment_ref" /></b>
                            </p>
                            <p t-if="o.narration" name="comment">
                                <span t-esc="o.narration" />
                            </p>
                            <t t-if="o.l10n_mx_edi_cfdi_uuid">
                                <p>
                                    <span t-esc="o.l10n_mx_edi_amount_to_text()" />
                                </p>
                            </t>
                            <p t-if="o.invoice_payment_term_id" name="payment_term">
                                <span t-field="o.invoice_payment_term_id.note" />
                            </p>
                            <b t-if="o.fiscal_position_id.note" name="note">
                                <span t-field="o.fiscal_position_id.note" />
                            </b>
                        </div>
                        <div class="col-6">
                            <table class="table table-sm" style="page-break-inside: avoid;">
                                <tr class="border-black o_subtotal" style="">
                                    <td><strong>Subtotal</strong></td>
                                    <td class="text-right">
                                        <span t-field="o.amount_untaxed" />
                                    </td>
                                </tr>
                                <t t-foreach="o.amount_by_group" t-as="amount_by_group">
                                    <tr style="">
                                        <t
                                            t-if="len(o.line_ids.filtered(lambda line: line.tax_line_id)) in [0, 1] and o.amount_untaxed == amount_by_group[2]">
                                            <td><span class="text-nowrap" t-esc="amount_by_group[0]" /></td>
                                            <td class="text-right o_price_total">
                                                <span class="text-nowrap" t-esc="amount_by_group[3]" />
                                            </td>
                                        </t>
                                        <t t-else="">
                                            <td>
                                                <span t-esc="amount_by_group[0]" />
                                                <span class="text-nowrap"> en
                                                    <t t-esc="amount_by_group[4]" />
                                                </span>
                                            </td>
                                            <td class="text-right o_price_total">
                                                <span class="text-nowrap" t-esc="amount_by_group[3]" />
                                            </td>
                                        </t>
                                    </tr>
                                </t>
                                <tr class="border-black o_total">
                                    <td><strong>Total</strong></td>
                                    <td class="text-right">
                                        <span class="text-nowrap" t-field="o.amount_total" />
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
                <t t-if="o.l10n_mx_edi_cfdi_uuid">
                    <div class="row" id='complement'>
                        <div class="barcode col-3">
                            <t t-set="sello" t-value="xml.get('Sello', 'No identificado')[-8:]" />
                            <img alt="Barcode" t-att-src="'/report/barcode/?type=QR&amp;value=%s&amp;width=180&amp;height=180' % quote_plus(
                            'https://verificacfdi.facturaelectronica.sat.gob.mx/default.aspx?' + keep_query(
                                re=o.l10n_mx_edi_cfdi_supplier_rfc, rr=o.l10n_mx_edi_cfdi_customer_rfc,
                                tt='%.*f' % (o.currency_id.decimal_places, o.l10n_mx_edi_cfdi_amount), id=o.l10n_mx_edi_cfdi_uuid)
                                + '&amp;fe=%s' % quote_plus(
                                    sello, 'utf-8', 'strict', '=/').replace('%2B', '+'))" />
                        </div>
                        <div class="complement-details col-9">
                            <div class="digital-stamp">
                               <span>Sello digital del emisor</span>
                            </div>
                            <div class="digital-stamp-content">
                                <span t-esc="xml.get('sello', xml.get('Sello', 'No identificado'))" />
                            </div>
                            <div class="digital-stamp">
                                <span>Sello digital de SAT</span>
                            </div>
                            <div class="digital-stamp-content">
                                <span t-esc="tfd.get('selloSAT', tfd.get('SelloSAT', 'No identificado'))" />
                            </div>
                            <div class="digital-stamp">
                                <span>Cadena original del complemento del certificado digital del SAT</span>
                            </div>
                            <div class="digital-stamp-content">
                                <span t-esc="tfd_original_string" />
                            </div>
                            <div t-if="xml.Emisor.xpath('cfdi:ExpedidoEn', namespaces=xml.nsmap)" class="digital-stamp">
                                <span>Emitido en</span>
                            </div>
                            <div t-if="xml.Emisor.xpath('cfdi:ExpedidoEn', namespaces=xml.nsmap)"
                                class="digital-stamp-content">
                                <span
                                    t-esc="' | '.join([ '%s: %s' % (key, value) for key, value in xml.Emisor.ExpedidoEn.items()])" />
                            </div>
                            <div class="digital-stamp">
                                <span>Información Extra</span>
                            </div>
                            <div class="digital-stamp-content">
                                <span>Certificado del emisor:</span> <span
                                    t-esc="xml.get('noCertificado', xml.get('NoCertificado'))" />
                                <span> | Certificado SAT:</span> <span t-esc="tfd.get('NoCertificadoSAT')" />
                                <span> | Lugar de expedición::</span> <span t-esc="xml.get('LugarExpedicion')" />
                                <span> | Fiscal Regime:</span><span t-esc="xml.Emisor.get('RegimenFiscal', '')" />
                                <span> | Fecha de Emisión:</span> <span
                                    t-esc="xml.get('fecha', xml.get('Fecha', '')).replace('T', ' ')" />
                                <span> | Fecha de Certificación:</span> <span
                                    t-esc="tfd.get('FechaTimbrado', '').replace('T', ' ')" />
                                <span> | Folio Fiscal:</span> <span t-esc="tfd.get('UUID')" />
                            </div>
                            <div class="digital-stamp-content text-center">
                                <strong>Este documento es una representación impresa de un CFDI</strong>
                            </div>
                        </div>
                    </div>
                </t>
                <div style="line-height:17px;font-size:12px;text-align:justify;">
                    Debe(mos ) y pagaré(mos ) incondicionalmente por es te pagaré único a la orden de DISTRIBUIDORA DE
                    INSUMOS AGROVETERINARIOS LA POTRANCA S.A. DE C.V. en Veracruz , Ver . la cantidad de ( ) valor
                    recibido a
                    mi(nuestra) entera satisfacción. Es te pagaré esta sujeto a la condición de que si no pagare a la
                    fecha de vencimiento y hasta el día de su liquidación causará intereses moratorios del 3% mensual.
                    AVISO
                    DE PRIVACIDAD Distribuidora de Insumos Agroveterinarios la Potranca, con domicilio en la calle
                    de Juan de la Luz Enríquez Número 312 centro, C.P. 95280, Lerdo de Tejada, Ver ., utilizará sus
                    datos
                    personales aquí recabados para nuestra relación comercial, para mayor información Usted puede
                    acceder al aviso de privacidad completo en http:www.lapotranca.com.mx<br />
                    Nombre:<br />
                    Población:<br />
                    Dirección:<br />
                    Acepto (amos )<br />
                    Firma (s )______________________________<br />
                    <center>= = = = = = = = = = Devoluciones o cambios sujetos a autorización máximo 3 días posteriores
                        a su
                        compra = = = = = = = = =</center>

                </div>
            </div>
        </xpath>


    </template>


</odoo>